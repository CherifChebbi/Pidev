{% extends 'event.html.twig' %}

{% block css %}
	{{ parent() }}
	<style>
		/* Ajoutez vos styles personnalisés ici */
		.sidebar {
			background-color: #f8f9fa;
			padding: 20px;
			border-radius: 5px;
			margin-bottom: 20px;
		}
		.filter-title {
			font-weight: bold;
			margin-bottom: 10px;
		}
		.filter-option {
			margin-bottom: 20px; /* Augmentation de l'espacement entre les options de filtrage */
		}
		.event-box {
			border: 1px solid #ccc;
			border-radius: 5px;
			padding: 20px;
			margin-bottom: 20px;
			max-height: 400px; /* Hauteur maximale */
			overflow-y: auto; /* Défilement vertical si nécessaire */
			background-color: #fff; /* Fond blanc pour une meilleure lisibilité */
			transition: box-shadow 0.3s; /* Effet de transition pour une meilleure expérience utilisateur */
			display: flex; /* Utilisation de flexbox pour centrer le contenu */
			flex-direction: column; /* Alignement vertical */
			justify-content: space-between; /* Espacement vertical égal */
		}
		.event-box:hover {
			box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* Ombre légère au survol pour une interaction visuelle */
		}
		.event-image {
			max-width: 100%;
			height: 200px; /* Hauteur fixe pour l'image */
			margin-bottom: 10px;
			object-fit: cover; /* Ajustement de l'image à la taille de son conteneur */
			border-radius: 5px; /* Coins arrondis pour une meilleure esthétique */
		}
		.event-title {
			font-weight: bold;
			margin-bottom: 5px; /* Espacement supplémentaire pour une meilleure lisibilité */
			color: #333; /* Couleur du titre pour une meilleure visibilité */
		}
		.event-date {
			margin-bottom: 10px;
			color: #666; /* Couleur de la date pour une meilleure visibilité */
		}
		.event-description {
			margin-bottom: 10px; /* Espacement supplémentaire pour une meilleure lisibilité */
			color: #666; /* Couleur de la description pour une meilleure visibilité */
		}
		.event-price-container {
			display: flex;
			justify-content: space-between;
		}
		.price-label {
			font-weight: bold;
		}
		.lieu-filter-checkboxes label {
			display: block;
			margin-bottom: 5px;
		}
		.price-control-button {
			background-color: #f8f9fa;
			border: none;
			cursor: pointer;
			padding: 5px 10px;
			border-radius: 3px;
		}
		.search-container {
			margin-bottom: 20px;
		}
		.search-input {
			width: 100%;
			padding: 10px;
			border-radius: 5px;
			border: 1px solid #ccc;
			box-sizing: border-box;
		}
		.event-text {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 20px;
		}
		.dropdown-menu {
			right: 0;
			left: auto;
		}
		.dropdown-toggle::after {
			display: inline-block;
			margin-left: 0.255em;
			vertical-align: 0.255em;
			content: "";
			border-top: 0.3em solid;
			border-right: 0.3em solid transparent;
			border-bottom: 0;
			border-left: 0.3em solid transparent;
		}
	</style>
{% endblock %}

{% block js %}
	{{ parent() }}
	<script>


		// Filtrage par prix
$("#price-slider").on("input", function () {
var value = $(this).val();
$("#current-price").text(value + " €");
filterEventsByPrice(parseInt(value));
});

$("#increase-price").click(function () {
var currentValue = parseInt($("#price-slider").val());
if (currentValue < 500) {
$("#price-slider").val(currentValue + 5).trigger("input");
}
});

$("#decrease-price").click(function () {
var currentValue = parseInt($("#price-slider").val());
if (currentValue > 0) {
$("#price-slider").val(currentValue - 5).trigger("input");
}
});

$("#set-price-range").click(function () {
var minPrice = parseInt($("#min-price").val());
var maxPrice = parseInt($("#max-price").val());
$("#price-slider").val(minPrice).trigger("input");
$("#current-price").text(minPrice + " €");
filterEventsByPrice(minPrice, maxPrice);
});

// Filtrage par date
$("#date-filter").on("change", function () {
var selectedDate = $(this).val();
$(".event-box").hide(); // Masquer tous les événements
$(".event-box[data-date='" + selectedDate + "']").show(); // Afficher les événements de la date sélectionnée
});

// Recherche d'événements
$("#search-button").on("click", function () {
var searchText = $("#search-input").val().toLowerCase();
$(".event-box").each(function () {
var eventTitle = $(this).find('.event-title').text().toLowerCase();
if (eventTitle.includes(searchText)) {
$(this).show();
} else {
$(this).hide();
}
});
});

function filterEventsByPrice(minPrice, maxPrice) {
$(".event-box").each(function () {
var eventPrice = parseInt($(this).find('.event-price').text());
if (eventPrice >= minPrice && eventPrice <= maxPrice) {
$(this).show();
} else {
$(this).hide();
}
});
}

$(function () { // Gestion du clic sur le bouton "Réserver"
$(".reserve-button").on("click", function () {
window.location.href = "{{ path('app_reservation_event_new_front') }}";
});
});

$(function () { // Gestion du clic sur le bouton "Réserver"
$(".reserve-button").on("click", function () { // Récupérer les données de l'événement correspondant
var titre = $(this).closest('.event-box').data('titre');
var image = $(this).closest('.event-box').data('imageEvent');
var description = $(this).closest('.event-box').data('description');
var prix = $(this).closest('.event-box').data('prix');

// Rediriger vers la page de réservation avec les paramètres de l'événement
window.location.href = "{{ path('app_reservation_event_new_front') }}?titre=" + encodeURIComponent(titre) + "&image=" + encodeURIComponent(image) + "&description=" + encodeURIComponent(description) + "&prix=" + encodeURIComponent(prix);
});
});

$(function () { // Filtrage par lieu
$("#lieu-filter").on("change", function () {
var selectedLieu = $(this).val();
if (selectedLieu === "") {
$(".event-box").show(); // Afficher tous les événements si "Tous les lieux" est sélectionné
} else {
$(".event-box").hide(); // Masquer tous les événements
$(".event-box[data-lieu='" + selectedLieu + "']").show(); // Afficher les événements du lieu sélectionné
}
});
});


document.querySelectorAll('.dropdown-item[data-route]').forEach(item => {
    item.addEventListener('click', function(event) {
        event.preventDefault(); // Empêche le lien de déclencher une redirection normale
        const route = this.dataset.route; // Récupère l'URL de la route Symfony depuis l'attribut data-route

        // Effectuez une requête AJAX vers la route Symfony
        fetch(route)
            .then(response => response.text()) // Convertit la réponse en texte
            .then(data => {
                // Mettez à jour la partie de votre page qui affiche les événements avec les données triées
                document.getElementById('events-container').innerHTML = data;
            })
            .catch(error => {
                console.error('Une erreur s\'est produite lors du chargement des événements triés :', error);
            });
    });
});
	</script>


{% endblock %}

{% block navbar %}
	{{ parent() }}
{% endblock %}

{% block footer %}
	{{ parent() }}
{% endblock %}

{% block body %}
	<div class="container">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item">
					<a href="{{ path('app_event_index_front') }}">Accueil/Events</a>
				</li>
			</ol>
		</nav>
		<div class="event-text">
			<h1>Events</h1>
			<div class="dropdown" style="float:right;">
				<button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					Trier par : Pertinence
				</button>
				<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="#">Pertinence</a>
					<a class="dropdown-item" href="#" data-route="{{ path('closest_events') }}">Date la plus proche</a>
					<a class="dropdown-item" href="#" data-route="{{ path('app_event_sort_by_price_ascending') }}">Prix croissant</a>
					<a class="dropdown-item" href="#" data-route="{{ path('app_event_sort_by_price_descending') }}">Prix décroissant</a>
					<div class="dropdown-divider"></div>
					<a class="dropdown-item" href="#" data-route="{{ path('app_event_sort_by_title_ascending') }}">A-Z</a>
					<div class="dropdown-divider"></div>
					<a class="dropdown-item" href="#" data-route="{{ path('app_event_sort_by_title_descending') }}">Z-A</a>
					<!-- Ajoutez d'autres options de tri si nécessaire -->
				</div>
			</div>
		</div>
		<p>
			Vous souhaitez assister à un événement de votre artiste préféré avec vos amis, offrir un billet à l'un de vos proches? Avec Terranova, trouvez facilement en quelques clics un billet pour l'événement de votre choix !
		</p>
		<div class="search-container">
			<input type="text" id="search-input" class="search-input" placeholder="Rechercher un événement...">
			<button id="search-button" class="btn btn-primary">Rechercher</button>
		</div>
		<div class="row">
			<div class="col-md-3">
				<div class="sidebar">
					<h2 class="filter-title">Filtrer les événements</h2>
					<!-- Filtrage par catégorie -->
					<div class="filter-option">
						<label for="category-filter">Catégorie :</label>
						<select id="category-filter">
							<option value="">Toutes les catégories</option>
							{% for category in categories|default([]) %}
								<option value="{{ category.id }}">{{ category.nom }}</option>
							{% endfor %}
						</select>
					</div>
					<!-- Filtrage par lieu -->
					<div class="filter-option">
						<label for="lieu-filter">Lieu :</label>
						<select id="lieu-filter">
							<option value="">Tous les lieux</option>
							{% for lieu in lieux|default([]) %}
								<option value="{{ lieu }}">{{ lieu }}</option>
							{% endfor %}
						</select>
					</div>
					<!-- Ajoutez d'autres options de filtrage si nécessaire -->
				</div>
			</div>
			<div class="col-md-9">
				<div class="row">
					{% for event in events|default([]) %}
						<div class="col-md-4 event-box mb-4" data-category="{{ event.Idcategory }}" data-date="{{ event.dateDebut | date('Y-m-d') }}" data-lieu="{{ event.lieu }}">
							<img src="{{ asset('uploads/' ~ event.imageEvent) }}" alt="{{ event.titre }}" class="event-image">
							<div class="event-title">{{ event.titre }}</div>
							<div class="event-date">{{ event.dateDebut | date('Y-m-d') }}</div>
							<div class="event-description">{{ event.description }}</div>
							<div class="event-price-container">
								<span class="price-label">Prix :</span>
								<span class="event-price">{{ event.prix }}</span>
							</div>
							<button class="reserve-button">Réserver</button>
						</div>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>
{% endblock %}
